<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محفظة المستخدم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        body { 
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .sidebar-item { 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .sidebar-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .sidebar-item:hover::before {
            left: 100%;
        }
        
        .sidebar-item:hover { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateX(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .sidebar-item.active { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .modal { display: none; }
        .modal.active { display: flex; }
        
        .fade-in { 
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes fadeInUp { 
            from { 
                opacity: 0; 
                transform: translateY(30px);
            } 
            to { 
                opacity: 1;
                transform: translateY(0);
            } 
        }
        
        .balance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            position: relative;
            overflow: hidden;
        }
        
        .balance-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }
        
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .input-field:focus {
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
            transform: scale(1.02);
        }
        
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .floating-circle {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .slide-in-right {
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification-enter {
            animation: notificationEnter 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes notificationEnter {
            from { transform: translateX(100%) scale(0.8); opacity: 0; }
            to { transform: translateX(0) scale(1); opacity: 1; }
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Floating Background Elements -->
    <div class="floating-elements">
        <div class="floating-circle" style="width: 100px; height: 100px; top: 10%; left: 10%; animation-delay: 0s;"></div>
        <div class="floating-circle" style="width: 150px; height: 150px; top: 20%; right: 15%; animation-delay: 2s;"></div>
        <div class="floating-circle" style="width: 80px; height: 80px; bottom: 20%; left: 20%; animation-delay: 4s;"></div>
        <div class="floating-circle" style="width: 120px; height: 120px; bottom: 10%; right: 10%; animation-delay: 1s;"></div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center relative overflow-hidden">
        <div class="glass-card rounded-2xl shadow-2xl p-8 w-96 max-w-90vw card-hover relative z-10">
            <div class="text-center mb-8">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center pulse">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold gradient-text mb-2">تسجيل الدخول</h1>
                <p class="text-gray-600">أدخل بياناتك للوصول إلى محفظتك الرقمية</p>
            </div>
            
            <form id="login-form">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        اسم المستخدم
                    </label>
                    <input type="text" id="login-username" required class="input-field w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        كلمة المرور
                    </label>
                    <input type="password" id="login-password" required class="input-field w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div class="mb-6">
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="remember-me" checked class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2">
                        <span class="mr-2 text-sm text-gray-700 flex items-center">
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            تذكر تسجيل الدخول
                        </span>
                    </label>
                </div>
                
                <button type="submit" class="btn-primary w-full text-white py-4 rounded-xl font-medium mb-6 relative z-10">
                    <svg class="w-5 h-5 inline ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                    </svg>
                    تسجيل الدخول
                </button>
            </form>
            
            <div class="text-center">
                <p class="text-gray-600 mb-4">ليس لديك حساب؟</p>
                <a href="https://www.g2a.com/" target="_blank" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-8 py-3 rounded-xl font-medium transition-all duration-300 inline-flex items-center transform hover:scale-105">
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                    </svg>
                    إنشاء حساب جديد
                </a>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden">
        <!-- Mobile Header -->
        <header class="glass-card shadow-lg p-4 relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-600/10"></div>
            <div class="flex justify-between items-center relative z-10">
                <div class="flex items-center">
                    <!-- Mobile Menu Button -->
                    <button onclick="toggleMobileMenu()" class="lg:hidden w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center ml-3 pulse">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <div class="hidden lg:flex w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl items-center justify-center ml-3 pulse">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                    </div>
                    <h1 class="text-xl lg:text-3xl font-bold gradient-text">محفظتي الرقمية</h1>
                </div>
                <div class="flex items-center space-x-2 space-x-reverse">
                    <div class="text-right hidden sm:block">
                        <p class="text-xs text-gray-500">مرحباً بك</p>
                        <span id="user-welcome" class="text-sm font-semibold text-gray-800"></span>
                    </div>
                    <button onclick="logout()" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-3 py-2 lg:px-6 lg:py-3 rounded-xl text-xs lg:text-sm font-medium transition-all duration-300 transform hover:scale-105 flex items-center">
                        <svg class="w-4 h-4 lg:ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        <span class="hidden lg:inline">تسجيل الخروج</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden" onclick="toggleMobileMenu()"></div>

        <!-- Mobile Sidebar -->
        <div id="mobile-sidebar" class="fixed top-0 right-0 h-full w-80 glass-card shadow-2xl z-50 transform translate-x-full transition-transform duration-300 lg:hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-blue-500/5 to-purple-600/5"></div>
            <div class="p-6 relative z-10">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-xl font-bold gradient-text">القائمة</h2>
                    <button onclick="toggleMobileMenu()" class="w-8 h-8 bg-gray-200 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- User Info in Mobile Menu -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 mb-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center ml-3">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">مرحباً بك</p>
                            <span id="mobile-user-welcome" class="font-semibold text-gray-800"></span>
                        </div>
                    </div>
                </div>
                
                <ul class="space-y-3">
                    <li>
                        <button onclick="showSection('dashboard'); toggleMobileMenu();" id="mobile-dashboard-btn" class="sidebar-item active w-full text-right p-4 rounded-xl font-medium flex items-center">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v0H8v0z"></path>
                            </svg>
                            الواجهة الرئيسية
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('withdraw'); toggleMobileMenu();" id="mobile-withdraw-btn" class="sidebar-item w-full text-right p-4 rounded-xl font-medium flex items-center">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                            سحب الأموال
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('transactions'); toggleMobileMenu();" id="mobile-transactions-btn" class="sidebar-item w-full text-right p-4 rounded-xl font-medium flex items-center">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            المعاملات
                        </button>
                    </li>
                    <li>
                        <button onclick="showSection('profile'); toggleMobileMenu();" id="mobile-profile-btn" class="sidebar-item w-full text-right p-4 rounded-xl font-medium flex items-center">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            الملف الشخصي
                        </button>
                    </li>
                </ul>
            </div>
        </div>

        <div class="flex min-h-screen">
            <!-- Desktop Sidebar -->
            <div class="hidden lg:block w-64 glass-card shadow-lg relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-b from-blue-500/5 to-purple-600/5"></div>
                <nav class="p-6 relative z-10">
                    <div class="mb-8">
                        <div class="w-16 h-16 mx-auto bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mb-3">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <p class="text-center text-sm text-gray-600">لوحة التحكم</p>
                    </div>
                    <ul class="space-y-3">
                        <li>
                            <button onclick="showSection('dashboard')" id="dashboard-btn" class="sidebar-item active w-full text-right p-4 rounded-xl font-medium flex items-center">
                                <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v0H8v0z"></path>
                                </svg>
                                الواجهة الرئيسية
                            </button>
                        </li>
                        <li>
                            <button onclick="showSection('withdraw')" id="withdraw-btn" class="sidebar-item w-full text-right p-4 rounded-xl font-medium flex items-center">
                                <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                </svg>
                                سحب الأموال
                            </button>
                        </li>
                        <li>
                            <button onclick="showSection('transactions')" id="transactions-btn" class="sidebar-item w-full text-right p-4 rounded-xl font-medium flex items-center">
                                <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                المعاملات
                            </button>
                        </li>
                        <li>
                            <button onclick="showSection('profile')" id="profile-btn" class="sidebar-item w-full text-right p-4 rounded-xl font-medium flex items-center">
                                <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                الملف الشخصي
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="flex-1 p-3 lg:p-6">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="fade-in">
                    <!-- Balance Card -->
                    <div class="balance-card rounded-2xl p-4 lg:p-8 text-white mb-6 lg:mb-8 card-hover relative overflow-hidden">
                        <div class="relative z-10">
                            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-4">
                                <div class="mb-4 lg:mb-0">
                                    <h2 class="text-lg lg:text-2xl font-bold mb-2 flex items-center">
                                        <svg class="w-6 h-6 lg:w-8 lg:h-8 ml-2 lg:ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                                        </svg>
                                        الرصيد الحالي
                                    </h2>
                                    <p class="text-2xl lg:text-4xl font-bold pulse" id="current-balance">0 دينار عراقي</p>
                                </div>
                                <div class="text-right opacity-80">
                                    <p class="text-xs lg:text-sm">آخر تحديث</p>
                                    <p class="text-xs" id="last-update">الآن</p>
                                </div>
                            </div>
                            <div class="flex items-center text-xs lg:text-sm opacity-90">
                                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                محفظة آمنة ومحمية
                            </div>
                        </div>
                    </div>

                    <!-- Add Balance Section -->
                    <div class="glass-card rounded-2xl shadow-lg p-4 lg:p-8 card-hover">
                        <h3 class="text-xl lg:text-2xl font-bold gradient-text mb-4 lg:mb-6 flex items-center">
                            <svg class="w-5 h-5 lg:w-6 lg:h-6 ml-2 lg:ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            إضافة رصيد
                        </h3>
                        
                        <!-- Payment Method Selection -->
                        <div class="mb-6 lg:mb-8">
                            <label class="block text-base lg:text-lg font-medium mb-3 lg:mb-4 text-gray-700">اختر طريقة الدفع</label>
                            <div class="grid grid-cols-1 gap-3 lg:gap-4">
                                <label class="relative cursor-pointer">
                                    <input type="radio" name="payment-method" value="asiacell-card" class="sr-only" onchange="showPaymentMethod('asiacell-card')">
                                    <div class="payment-option border-2 border-gray-200 rounded-xl p-4 lg:p-6 transition-all duration-300 hover:border-blue-400 hover:shadow-lg">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 lg:w-12 lg:h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center ml-3 lg:ml-4">
                                                <svg class="w-5 h-5 lg:w-6 lg:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                                                </svg>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-800 text-sm lg:text-base">كارت اسياسيل</h4>
                                                <p class="text-xs lg:text-sm text-gray-600">استخدم رقم الكارت</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="relative cursor-pointer">
                                    <input type="radio" name="payment-method" value="asiacell-transfer" class="sr-only" onchange="showPaymentMethod('asiacell-transfer')">
                                    <div class="payment-option border-2 border-gray-200 rounded-xl p-4 lg:p-6 transition-all duration-300 hover:border-blue-400 hover:shadow-lg">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 lg:w-12 lg:h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center ml-3 lg:ml-4">
                                                <svg class="w-5 h-5 lg:w-6 lg:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                                </svg>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-800 text-sm lg:text-base">تحويل اسياسيل</h4>
                                                <p class="text-xs lg:text-sm text-gray-600">تحويل مباشر</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Asiacell Card Method -->
                        <div id="asiacell-card-method" class="hidden slide-in-right">
                            <div class="bg-gradient-to-r from-green-50 to-green-100 border border-green-200 rounded-xl p-4 lg:p-6 mb-4 lg:mb-6">
                                <h4 class="font-semibold text-green-800 mb-3 lg:mb-2 flex items-center text-sm lg:text-base">
                                    <svg class="w-4 h-4 lg:w-5 lg:h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                                    </svg>
                                    كارت اسياسيل
                                </h4>
                                <div class="mb-4">
                                    <label class="block text-xs lg:text-sm font-medium mb-2 text-gray-700">رقم كارت اسياسيل</label>
                                    <input type="text" id="asiacell-card-number" class="input-field w-full p-3 lg:p-4 border border-gray-300 rounded-xl text-sm lg:text-base" placeholder="أدخل رقم الكارت">
                                </div>
                                <button onclick="submitAsiacellCard()" class="btn-primary text-white px-6 lg:px-8 py-3 rounded-xl font-medium flex items-center text-sm lg:text-base w-full lg:w-auto justify-center">
                                    <svg class="w-4 h-4 lg:w-5 lg:h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    تعبئة الرصيد
                                </button>
                            </div>
                        </div>

                        <!-- Asiacell Transfer Method -->
                        <div id="asiacell-transfer-method" class="hidden slide-in-right">
                            <div class="bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-4 lg:p-6 mb-4 lg:mb-6">
                                <h4 class="font-semibold text-blue-800 mb-3 lg:mb-4 flex items-center text-sm lg:text-base">
                                    <svg class="w-4 h-4 lg:w-5 lg:h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                    </svg>
                                    تحويل اسياسيل
                                </h4>
                                
                                <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-3 lg:p-4 mb-3 lg:mb-4">
                                    <div class="flex items-start">
                                        <svg class="w-4 h-4 lg:w-5 lg:h-5 text-yellow-600 mt-0.5 ml-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                        </svg>
                                        <div>
                                            <p class="text-yellow-800 font-medium text-xs lg:text-sm">ملاحظة مهمة:</p>
                                            <p class="text-yellow-700 text-xs lg:text-sm">يجب التحويل من نفس رقم الهاتف المسجل به الحساب لكي يتم إضافة الرصيد إلى حسابك بدون مشاكل</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 border border-blue-200 rounded-xl p-3 lg:p-4 mb-3 lg:mb-4 text-center">
                                    <p class="text-blue-800 font-medium mb-2 text-xs lg:text-sm">قم بتحويل الرصيد إلى هذا الرقم:</p>
                                    <div class="bg-white rounded-lg p-2 lg:p-3 inline-block">
                                        <p class="text-blue-700 text-lg lg:text-2xl font-bold">07732773761</p>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-xs lg:text-sm font-medium mb-2 text-gray-700">المبلغ المحول</label>
                                    <input type="number" id="transfer-amount" class="input-field w-full p-3 lg:p-4 border border-gray-300 rounded-xl text-sm lg:text-base" placeholder="أدخل المبلغ المحول">
                                </div>
                                <button onclick="submitAsiacellTransfer()" class="btn-primary text-white px-6 lg:px-8 py-3 rounded-xl font-medium flex items-center text-sm lg:text-base w-full lg:w-auto justify-center">
                                    <svg class="w-4 h-4 lg:w-5 lg:h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    تعبئة الرصيد
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Withdraw Section -->
                <div id="withdraw-section" class="hidden fade-in">
                    <div class="glass-card rounded-2xl shadow-lg p-4 lg:p-8 card-hover">
                        <h3 class="text-xl lg:text-2xl font-bold gradient-text mb-4 lg:mb-6 flex items-center">
                            <svg class="w-5 h-5 lg:w-6 lg:h-6 ml-2 lg:ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                            سحب الأموال
                        </h3>
                        
                        <div class="mb-4 lg:mb-6">
                            <label class="block text-xs lg:text-sm font-medium mb-2 lg:mb-3 text-gray-700">طريقة السحب</label>
                            <div class="relative">
                                <select class="input-field w-full p-3 lg:p-4 border border-gray-300 rounded-xl bg-gray-50 text-sm lg:text-base" disabled>
                                    <option>مصرف الرافدين</option>
                                </select>
                                <div class="absolute left-3 lg:left-4 top-1/2 transform -translate-y-1/2">
                                    <svg class="w-4 h-4 lg:w-5 lg:h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-4 lg:mb-6">
                            <label class="block text-xs lg:text-sm font-medium mb-2 lg:mb-3 text-gray-700">رقم الحساب</label>
                            <input type="text" id="withdraw-account" readonly class="input-field w-full p-3 lg:p-4 border border-gray-300 rounded-xl bg-gray-50 text-sm lg:text-base">
                        </div>
                        
                        <div class="mb-4 lg:mb-6">
                            <label class="block text-xs lg:text-sm font-medium mb-2 lg:mb-3 text-gray-700">المبلغ المراد سحبه</label>
                            <input type="number" id="withdraw-amount" class="input-field w-full p-3 lg:p-4 border border-gray-300 rounded-xl text-sm lg:text-base" placeholder="أدخل المبلغ" onkeyup="calculateWithdrawFee()">
                        </div>
                        
                        <div class="bg-gradient-to-r from-red-50 to-red-100 border border-red-200 rounded-xl p-3 lg:p-6 mb-4 lg:mb-6">
                            <div class="flex items-start">
                                <svg class="w-5 h-5 lg:w-6 lg:h-6 text-red-600 mt-0.5 ml-2 lg:ml-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                                <div>
                                    <p class="text-red-800 font-semibold mb-2 text-xs lg:text-sm">ملاحظة مهمة:</p>
                                    <p class="text-red-700 mb-2 text-xs lg:text-sm">سيتم استقطاع عمولة 15% من المبلغ المسحوب</p>
                                    <div class="bg-white rounded-lg p-2 lg:p-3">
                                        <p class="text-red-700 font-bold text-sm lg:text-lg" id="final-amount">المبلغ النهائي: 0 دينار عراقي</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="submitWithdraw()" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 lg:px-8 py-3 lg:py-4 rounded-xl font-medium transition-all duration-300 transform hover:scale-105 flex items-center text-sm lg:text-base w-full lg:w-auto justify-center">
                            <svg class="w-4 h-4 lg:w-5 lg:h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            تأكيد السحب
                        </button>
                    </div>
                </div>

                <!-- Transactions Section -->
                <div id="transactions-section" class="hidden fade-in">
                    <div class="glass-card rounded-2xl shadow-lg p-4 lg:p-8 card-hover">
                        <h3 class="text-xl lg:text-2xl font-bold gradient-text mb-4 lg:mb-6 flex items-center">
                            <svg class="w-5 h-5 lg:w-6 lg:h-6 ml-2 lg:ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            المعاملات
                        </h3>
                        
                        <!-- Transaction Filters -->
                        <div class="flex flex-wrap gap-2 lg:gap-3 mb-6 lg:mb-8">
                            <button onclick="filterTransactions('all')" id="all-trans-btn" class="px-3 lg:px-6 py-2 lg:py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-medium transition-all duration-300 transform hover:scale-105 text-xs lg:text-sm">
                                جميع المعاملات
                            </button>
                            <button onclick="filterTransactions('deposit')" id="deposit-trans-btn" class="px-3 lg:px-6 py-2 lg:py-3 bg-gray-200 text-gray-700 rounded-xl font-medium transition-all duration-300 hover:bg-gray-300 text-xs lg:text-sm">
                                إضافة الأموال
                            </button>
                            <button onclick="filterTransactions('withdraw')" id="withdraw-trans-btn" class="px-3 lg:px-6 py-2 lg:py-3 bg-gray-200 text-gray-700 rounded-xl font-medium transition-all duration-300 hover:bg-gray-300 text-xs lg:text-sm">
                                سحب الأموال
                            </button>
                        </div>
                        
                        <!-- Transactions Table -->
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse min-w-full">
                                <thead>
                                    <tr class="bg-gradient-to-r from-gray-50 to-gray-100">
                                        <th class="border border-gray-200 p-2 lg:p-4 text-right font-semibold text-gray-700 rounded-tl-xl text-xs lg:text-sm">النوع</th>
                                        <th class="border border-gray-200 p-2 lg:p-4 text-right font-semibold text-gray-700 text-xs lg:text-sm">المبلغ</th>
                                        <th class="border border-gray-200 p-2 lg:p-4 text-right font-semibold text-gray-700 text-xs lg:text-sm">الحالة</th>
                                        <th class="border border-gray-200 p-2 lg:p-4 text-right font-semibold text-gray-700 rounded-tr-xl text-xs lg:text-sm">التاريخ</th>
                                    </tr>
                                </thead>
                                <tbody id="transactions-table">
                                    <!-- Transactions will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Profile Section -->
                <div id="profile-section" class="hidden fade-in">
                    <div class="glass-card rounded-2xl shadow-lg p-4 lg:p-8 card-hover">
                        <h3 class="text-xl lg:text-2xl font-bold gradient-text mb-4 lg:mb-6 flex items-center">
                            <svg class="w-5 h-5 lg:w-6 lg:h-6 ml-2 lg:ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            الملف الشخصي
                        </h3>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6">
                            <div class="space-y-4 lg:space-y-6">
                                <div>
                                    <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        <svg class="w-3 h-3 lg:w-4 lg:h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                        الاسم
                                    </label>
                                    <input type="text" id="profile-name" readonly class="input-field w-full p-3 lg:p-4 border border-gray-300 rounded-xl bg-gray-50 text-sm lg:text-base">
                                </div>
                                
                                <div>
                                    <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        <svg class="w-3 h-3 lg:w-4 lg:h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                                        </svg>
                                        اسم المستخدم
                                    </label>
                                    <input type="text" id="profile-username" readonly class="input-field w-full p-3 lg:p-4 border border-gray-300 rounded-xl bg-gray-50 text-sm lg:text-base">
                                </div>
                            </div>
                            
                            <div class="space-y-4 lg:space-y-6">
                                <div>
                                    <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        <svg class="w-3 h-3 lg:w-4 lg:h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                        </svg>
                                        رقم الهاتف
                                    </label>
                                    <input type="text" id="profile-phone" readonly class="input-field w-full p-3 lg:p-4 border border-gray-300 rounded-xl bg-gray-50 text-sm lg:text-base">
                                </div>
                                
                                <div>
                                    <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-2 flex items-center">
                                        <svg class="w-3 h-3 lg:w-4 lg:h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                        </svg>
                                        رقم حساب مصرف الرافدين
                                    </label>
                                    <input type="text" id="profile-account" readonly class="input-field w-full p-3 lg:p-4 border border-gray-300 rounded-xl bg-gray-50 text-sm lg:text-base">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 lg:mt-8 p-4 lg:p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-200">
                            <div class="flex items-center">
                                <svg class="w-6 h-6 lg:w-8 lg:h-8 text-blue-600 ml-2 lg:ml-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                </svg>
                                <div>
                                    <h4 class="font-semibold text-blue-800 text-sm lg:text-base">حساب محمي</h4>
                                    <p class="text-xs lg:text-sm text-blue-600">جميع بياناتك محمية ومشفرة بأعلى معايير الأمان</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getDatabase, ref, push, get, update, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAa2PVwT36vFMm7YclMe774O0FI3gHq18A",
            authDomain: "racedasia.firebaseapp.com",
            databaseURL: "https://racedasia-default-rtdb.firebaseio.com",
            projectId: "racedasia",
            storageBucket: "racedasia.firebasestorage.app",
            messagingSenderId: "159044675488",
            appId: "1:159044675488:web:a65302f190c0e7011fe6c5",
            measurementId: "G-P271HH75LY"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Global variables
        window.currentUser = null;
        window.userTransactions = [];
        window.currentTransactionFilter = 'all';

        // Check for saved login on page load
        window.addEventListener('load', function() {
            checkSavedLogin();
        });

        // Check if user is already logged in
        async function checkSavedLogin() {
            const savedUser = localStorage.getItem('walletUser');
            if (savedUser) {
                try {
                    const userData = JSON.parse(savedUser);
                    
                    // Verify user still exists in database and get updated data
                    const userRef = ref(database, `users/${userData.id}`);
                    const snapshot = await get(userRef);
                    
                    if (snapshot.exists()) {
                        window.currentUser = { id: userData.id, ...snapshot.val() };
                        showMainApp();
                    } else {
                        // User no longer exists, clear saved data
                        localStorage.removeItem('walletUser');
                    }
                } catch (error) {
                    console.error('خطأ في التحقق من تسجيل الدخول المحفوظ:', error);
                    localStorage.removeItem('walletUser');
                }
            }
        }

        // Save user login to localStorage
        function saveUserLogin(user) {
            localStorage.setItem('walletUser', JSON.stringify(user));
        }

        // Clear saved login
        function clearSavedLogin() {
            localStorage.removeItem('walletUser');
        }

        // Login functionality
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const usersRef = ref(database, 'users');
                const snapshot = await get(usersRef);
                
                if (snapshot.exists()) {
                    const users = snapshot.val();
                    let userFound = false;
                    
                    for (const [userId, userData] of Object.entries(users)) {
                        if (userData.username === username && userData.password === password) {
                            window.currentUser = { id: userId, ...userData };
                            
                            // Save login only if remember me is checked
                            const rememberMe = document.getElementById('remember-me').checked;
                            if (rememberMe) {
                                saveUserLogin(window.currentUser);
                            }
                            
                            userFound = true;
                            break;
                        }
                    }
                    
                    if (userFound) {
                        showMainApp();
                    } else {
                        showErrorMessage('اسم المستخدم أو كلمة المرور غير صحيحة');
                    }
                } else {
                    showErrorMessage('لا توجد بيانات مستخدمين');
                }
            } catch (error) {
                showErrorMessage('حدث خطأ في تسجيل الدخول: ' + error.message);
            }
        });

        // Show main app after login
        function showMainApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            // Update user info
            document.getElementById('user-welcome').textContent = `${window.currentUser.name}`;
            document.getElementById('mobile-user-welcome').textContent = `${window.currentUser.name}`;
            document.getElementById('current-balance').textContent = `${window.currentUser.balance || 0} دينار عراقي`;
            document.getElementById('withdraw-account').value = window.currentUser.account;
            
            // Load profile data
            document.getElementById('profile-name').value = window.currentUser.name;
            document.getElementById('profile-username').value = window.currentUser.username;
            document.getElementById('profile-phone').value = window.currentUser.phone;
            document.getElementById('profile-account').value = window.currentUser.account;
            
            // Load user transactions
            loadUserTransactions();
        }

        // Mobile menu toggle
        window.toggleMobileMenu = function() {
            const overlay = document.getElementById('mobile-menu-overlay');
            const sidebar = document.getElementById('mobile-sidebar');
            
            if (overlay.classList.contains('hidden')) {
                overlay.classList.remove('hidden');
                sidebar.classList.remove('translate-x-full');
            } else {
                overlay.classList.add('hidden');
                sidebar.classList.add('translate-x-full');
            }
        };

        // Logout functionality
        window.logout = function() {
            window.currentUser = null;
            clearSavedLogin(); // Clear saved login data
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('login-form').reset();
            showSuccessMessage('تم تسجيل الخروج بنجاح');
        };

        // Section navigation
        window.showSection = function(sectionName) {
            // Hide all sections
            document.getElementById('dashboard-section').classList.add('hidden');
            document.getElementById('withdraw-section').classList.add('hidden');
            document.getElementById('transactions-section').classList.add('hidden');
            document.getElementById('profile-section').classList.add('hidden');
            
            // Remove active class from all buttons (desktop and mobile)
            document.querySelectorAll('.sidebar-item').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section and activate buttons (both desktop and mobile)
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            const desktopBtn = document.getElementById(sectionName + '-btn');
            const mobileBtn = document.getElementById('mobile-' + sectionName + '-btn');
            
            if (desktopBtn) desktopBtn.classList.add('active');
            if (mobileBtn) mobileBtn.classList.add('active');
        };

        // Payment method selection
        window.showPaymentMethod = function(method) {
            // Remove active state from all options
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('border-blue-500', 'bg-blue-50');
                option.classList.add('border-gray-200');
            });
            
            // Add active state to selected option
            const selectedOption = document.querySelector(`input[value="${method}"]`).parentElement.querySelector('.payment-option');
            selectedOption.classList.remove('border-gray-200');
            selectedOption.classList.add('border-blue-500', 'bg-blue-50');
            
            // Hide all method forms
            document.getElementById('asiacell-card-method').classList.add('hidden');
            document.getElementById('asiacell-transfer-method').classList.add('hidden');
            
            // Show selected method form with animation
            if (method === 'asiacell-card') {
                setTimeout(() => {
                    document.getElementById('asiacell-card-method').classList.remove('hidden');
                    document.getElementById('asiacell-card-method').classList.add('slide-in-right');
                }, 100);
            } else if (method === 'asiacell-transfer') {
                setTimeout(() => {
                    document.getElementById('asiacell-transfer-method').classList.remove('hidden');
                    document.getElementById('asiacell-transfer-method').classList.add('slide-in-right');
                }, 100);
            }
        };

        // Submit Asiacell Card
        window.submitAsiacellCard = async function() {
            const cardNumber = document.getElementById('asiacell-card-number').value;
            
            if (!cardNumber) {
                showErrorMessage('يرجى إدخال رقم الكارت');
                return;
            }
            
            try {
                const transactionData = {
                    type: 'deposit',
                    userId: window.currentUser.id,
                    phone: window.currentUser.phone,
                    paymentMethod: 'كارت اسياسيل',
                    details: `رقم الكارت: ${cardNumber}`,
                    amount: 0, // Amount will be determined by admin
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                const transactionsRef = ref(database, 'transactions');
                await push(transactionsRef, transactionData);
                
                showSuccessMessage('سيتم إضافة الرصيد إلى حسابك خلال ساعات قليلة');
                document.getElementById('asiacell-card-number').value = '';
                loadUserTransactions();
            } catch (error) {
                showErrorMessage('حدث خطأ: ' + error.message);
            }
        };

        // Submit Asiacell Transfer
        window.submitAsiacellTransfer = async function() {
            const amount = document.getElementById('transfer-amount').value;
            
            if (!amount || amount <= 0) {
                showErrorMessage('يرجى إدخال مبلغ صحيح');
                return;
            }
            
            try {
                const transactionData = {
                    type: 'deposit',
                    userId: window.currentUser.id,
                    phone: window.currentUser.phone,
                    paymentMethod: 'تحويل اسياسيل',
                    details: `تحويل بمبلغ ${amount} دينار إلى 07732773761`,
                    amount: parseInt(amount),
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                const transactionsRef = ref(database, 'transactions');
                await push(transactionsRef, transactionData);
                
                showSuccessMessage('سيتم إضافة الرصيد إلى حسابك خلال ساعات قليلة');
                document.getElementById('transfer-amount').value = '';
                loadUserTransactions();
            } catch (error) {
                showErrorMessage('حدث خطأ: ' + error.message);
            }
        };

        // Calculate withdraw fee
        window.calculateWithdrawFee = function() {
            const amount = document.getElementById('withdraw-amount').value;
            if (amount && amount > 0) {
                const fee = amount * 0.15; // 15% fee
                const finalAmount = amount - fee;
                document.getElementById('final-amount').textContent = `المبلغ النهائي: ${finalAmount} دينار عراقي`;
            } else {
                document.getElementById('final-amount').textContent = 'المبلغ النهائي: 0 دينار عراقي';
            }
        };

        // Submit withdraw
        window.submitWithdraw = async function() {
            const amount = document.getElementById('withdraw-amount').value;
            
            if (!amount || amount <= 0) {
                showErrorMessage('يرجى إدخال مبلغ صحيح');
                return;
            }
            
            if (parseInt(amount) > window.currentUser.balance) {
                showErrorMessage('الرصيد غير كافي');
                return;
            }
            
            try {
                const fee = amount * 0.15;
                const finalAmount = amount - fee;
                
                // Create transaction
                const transactionData = {
                    type: 'withdraw',
                    userId: window.currentUser.id,
                    phone: window.currentUser.phone,
                    paymentMethod: 'مصرف الرافدين',
                    details: `سحب إلى حساب ${window.currentUser.account}`,
                    amount: parseInt(amount),
                    finalAmount: finalAmount,
                    fee: fee,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                
                const transactionsRef = ref(database, 'transactions');
                await push(transactionsRef, transactionData);
                
                // Update user balance
                const newBalance = window.currentUser.balance - parseInt(amount);
                const userRef = ref(database, `users/${window.currentUser.id}`);
                await update(userRef, { balance: newBalance });
                
                // Update local user data
                window.currentUser.balance = newBalance;
                document.getElementById('current-balance').textContent = `${newBalance} دينار عراقي`;
                
                showSuccessMessage('تم تقديم طلب السحب بنجاح');
                document.getElementById('withdraw-amount').value = '';
                document.getElementById('final-amount').textContent = 'المبلغ النهائي: 0 دينار عراقي';
                loadUserTransactions();
            } catch (error) {
                showErrorMessage('حدث خطأ: ' + error.message);
            }
        };

        // Load user transactions
        async function loadUserTransactions() {
            try {
                const transactionsRef = ref(database, 'transactions');
                const snapshot = await get(transactionsRef);
                
                if (snapshot.exists()) {
                    const allTransactions = snapshot.val();
                    window.userTransactions = Object.entries(allTransactions)
                        .map(([id, data]) => ({ id, ...data }))
                        .filter(transaction => transaction.userId === window.currentUser.id)
                        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                } else {
                    window.userTransactions = [];
                }
                
                displayTransactions();
            } catch (error) {
                console.error('خطأ في تحميل المعاملات:', error);
            }
        }

        // Display transactions
        function displayTransactions() {
            const tbody = document.getElementById('transactions-table');
            tbody.innerHTML = '';
            
            const filteredTransactions = window.currentTransactionFilter === 'all' 
                ? window.userTransactions 
                : window.userTransactions.filter(t => t.type === window.currentTransactionFilter);
            
            if (filteredTransactions.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" class="border border-gray-300 p-4 text-center text-gray-500 text-sm">
                        لا توجد معاملات لعرضها
                    </td>
                `;
                tbody.appendChild(row);
                return;
            }
            
            filteredTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                const statusClass = transaction.status === 'approved' ? 'text-green-600' : 
                                  transaction.status === 'rejected' ? 'text-red-600' : 'text-yellow-600';
                
                const statusText = transaction.status === 'approved' ? 'مقبول' : 
                                 transaction.status === 'rejected' ? 'مرفوض' : 'في الانتظار';
                
                const typeText = transaction.type === 'deposit' ? 'إضافة أموال' : 'سحب أموال';
                const date = new Date(transaction.createdAt).toLocaleDateString('ar-EG');
                
                row.innerHTML = `
                    <td class="border border-gray-300 p-2 lg:p-3 text-xs lg:text-sm">${typeText}</td>
                    <td class="border border-gray-300 p-2 lg:p-3 text-xs lg:text-sm">${transaction.amount} دينار</td>
                    <td class="border border-gray-300 p-2 lg:p-3 text-xs lg:text-sm ${statusClass}">${statusText}</td>
                    <td class="border border-gray-300 p-2 lg:p-3 text-xs lg:text-sm">${date}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Filter transactions
        window.filterTransactions = function(type) {
            window.currentTransactionFilter = type;
            
            // Update button styles
            document.getElementById('all-trans-btn').className = type === 'all' ? 'px-4 py-2 bg-blue-500 text-white rounded-lg' : 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg';
            document.getElementById('deposit-trans-btn').className = type === 'deposit' ? 'px-4 py-2 bg-blue-500 text-white rounded-lg' : 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg';
            document.getElementById('withdraw-trans-btn').className = type === 'withdraw' ? 'px-4 py-2 bg-blue-500 text-white rounded-lg' : 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg';
            
            displayTransactions();
        };

        // Success and Error Messages
        window.showSuccessMessage = function(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 left-4 lg:top-6 lg:right-6 lg:left-auto bg-gradient-to-r from-green-500 to-green-600 text-white px-4 lg:px-8 py-3 lg:py-4 rounded-2xl shadow-2xl z-50 transform translate-x-full lg:translate-x-full transition-all duration-500 notification-enter max-w-sm lg:max-w-none mx-auto lg:mx-0';
            toast.innerHTML = `
                <div class="flex items-center">
                    <div class="w-6 h-6 lg:w-8 lg:h-8 bg-white/20 rounded-full flex items-center justify-center ml-2 lg:ml-3 flex-shrink-0">
                        <svg class="w-4 h-4 lg:w-5 lg:h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="font-semibold text-sm lg:text-base">نجح!</p>
                        <p class="text-xs lg:text-sm opacity-90">${message}</p>
                    </div>
                </div>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => document.body.removeChild(toast), 500);
            }, 4000);
        };

        window.showErrorMessage = function(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 left-4 lg:top-6 lg:right-6 lg:left-auto bg-gradient-to-r from-red-500 to-red-600 text-white px-4 lg:px-8 py-3 lg:py-4 rounded-2xl shadow-2xl z-50 transform translate-x-full lg:translate-x-full transition-all duration-500 notification-enter max-w-sm lg:max-w-none mx-auto lg:mx-0';
            toast.innerHTML = `
                <div class="flex items-center">
                    <div class="w-6 h-6 lg:w-8 lg:h-8 bg-white/20 rounded-full flex items-center justify-center ml-2 lg:ml-3 flex-shrink-0">
                        <svg class="w-4 h-4 lg:w-5 lg:h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="font-semibold text-sm lg:text-base">خطأ!</p>
                        <p class="text-xs lg:text-sm opacity-90">${message}</p>
                    </div>
                </div>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => document.body.removeChild(toast), 500);
            }, 4000);
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e808ca7460d0db',t:'MTc1Nzc3MDU5NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
